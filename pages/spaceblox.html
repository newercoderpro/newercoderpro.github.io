<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SpaceBlox</title>

<style>
html, body {
    margin: 0;
    height: 100%;
    background: #333;
    color: white;
    font-family: Arial, sans-serif;
    overflow: hidden;
}

#navlink {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    background: #d3d3d3;
    color: #333;
    text-align: center;
    padding: 10px 0;
    font-size: 16px;
    z-index: 30;
}

/* ---------- LAYOUT ---------- */
#game-wrapper {
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

#game-container {
    position: relative;
}

/* ---------- CANVAS ---------- */
#gameCanvas {
    background: black;
    border: 2px solid white;
}

/* ---------- PAUSE BUTTON ---------- */
#pause-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 15;
    padding: 8px 12px;
    font-size: 16px;
    border-radius: 8px;
    border: none;
    background: rgba(255,255,255,0.25);
    color: white;
}

/* ---------- PAUSE MENU (CANVAS ONLY) ---------- */
#pause-menu {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.6);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 20;
}

#pause-menu button {
    padding: 10px 20px;
    font-size: 18px;
    margin-top: 15px;
}

.hidden {
    display: none;
}

/* ---------- SETTINGS BELOW CANVAS ---------- */
#settings {
    display: flex;
    gap: 20px;
    font-size: 14px;
}

.setting {
    display: flex;
    align-items: center;
    gap: 6px;
}

.setting input {
    width: 60px;
}

/* ---------- MOBILE CONTROLS ---------- */
#mobile-controls {
    position: absolute;
    inset: 0;
    pointer-events: none;
    display: none;
}

#move-controls {
    position: absolute;
    left: 10px;
    bottom: 10px;
    display: flex;
    gap: 10px;
    pointer-events: auto;
}

#btnLeft, #btnRight, #btnShoot {
    width: 65px;
    height: 65px;
    font-size: 26px;
    border-radius: 14px;
    border: none;
    background: rgba(255,255,255,0.25);
    color: white;
}

#btnShoot {
    position: absolute;
    right: 10px;
    bottom: 10px;
    pointer-events: auto;
}

@media (pointer: coarse) {
    #mobile-controls {
        display: block;
    }
}
</style>
</head>

<body>
<h2 id="navlink">SpaceBlox</h2>

<div id="game-wrapper">

    <div id="game-container">
        <canvas id="gameCanvas"></canvas>
        <button id="pause-btn">⏸</button>

        <div id="pause-menu" class="hidden">
            <h1>Paused</h1>
            <button id="resumeBtn">Resume</button>
        </div>

        <!-- Mobile controls -->
        <div id="mobile-controls">
            <div id="move-controls">
                <button id="btnLeft">◀</button>
                <button id="btnRight">▶</button>
            </div>
            <button id="btnShoot">●</button>
        </div>
    </div>

    <!-- Settings -->
    <div id="settings">
        <div class="setting">
            <label>Player Speed</label>
            <input type="number" id="playerSpeed" value="5" min="0" step="0.5">
        </div>
        <div class="setting">
            <label>Enemy Speed</label>
            <input type="number" id="enemySpeed" value="5" min="0" step="0.5">
        </div>
    </div>

</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

const pauseBtn = document.getElementById("pause-btn");
const pauseMenu = document.getElementById("pause-menu");
const resumeBtn = document.getElementById("resumeBtn");

const playerSpeedInput = document.getElementById("playerSpeed");
const enemySpeedInput = document.getElementById("enemySpeed");

let keys = {};
let isPaused = false;
let BASE_SIZE = 40;

let player = { x:0, y:0, w:0, h:0, speed:0, shooting:false };
let bullets = [];
let enemies = [];

/* ---------- RESIZE ---------- */
function resizeCanvas() {
    canvas.width = Math.min(window.innerWidth * 0.9, 600);
    canvas.height = window.innerHeight * 0.6;

    BASE_SIZE = Math.min(canvas.width, canvas.height) * 0.08;

    player.w = BASE_SIZE * 0.85;
    player.h = player.w;
    player.x = canvas.width / 2 - player.w / 2;
    player.y = canvas.height - player.h - 10;

    updateSpeeds();
}
window.addEventListener("resize", resizeCanvas);

/* ---------- SPEED ---------- */
function updateSpeeds() {
    player.speed = BASE_SIZE * 0.08 * playerSpeedInput.value;
}
playerSpeedInput.oninput = updateSpeeds;
enemySpeedInput.oninput = updateSpeeds;

/* ---------- INPUT ---------- */
window.addEventListener("keydown", e => {
    keys[e.key] = true;
    if (e.key === "Escape") togglePause();
});
window.addEventListener("keyup", e => keys[e.key] = false);

/* Mobile */
const btnLeft = document.getElementById("btnLeft");
const btnRight = document.getElementById("btnRight");
const btnShoot = document.getElementById("btnShoot");

function bind(btn, key) {
    btn.addEventListener("touchstart", e => { e.preventDefault(); keys[key] = true; });
    btn.addEventListener("touchend", e => { e.preventDefault(); keys[key] = false; });
}
bind(btnLeft, "ArrowLeft");
bind(btnRight, "ArrowRight");

btnShoot.addEventListener("touchstart", e => {
    e.preventDefault();
    if (!player.shooting) shoot();
    player.shooting = true;
});
btnShoot.addEventListener("touchend", () => player.shooting = false);

pauseBtn.onclick = togglePause;
resumeBtn.onclick = togglePause;

/* ---------- GAME ---------- */
function shoot() {
    bullets.push({
        x: player.x + player.w / 2 - BASE_SIZE * 0.1,
        y: player.y,
        w: BASE_SIZE * 0.2,
        h: BASE_SIZE * 0.5,
        s: BASE_SIZE * 0.6
    });
}

function spawnEnemy() {
    enemies.push({
        x: Math.random() * (canvas.width - BASE_SIZE),
        y: -BASE_SIZE,
        w: BASE_SIZE,
        h: BASE_SIZE,
        s: BASE_SIZE * 0.07 * enemySpeedInput.value
    });
}

function update() {
    if (isPaused) return;

    if ((keys["ArrowLeft"] || keys["a"]) && player.x > 0) player.x -= player.speed;
    if ((keys["ArrowRight"] || keys["d"]) && player.x + player.w < canvas.width) player.x += player.speed;

    if ((keys[" "] || keys["ArrowUp"]) && !player.shooting) {
        shoot();
        player.shooting = true;
    }
    if (!keys[" "] && !keys["ArrowUp"]) player.shooting = false;

    bullets.forEach(b => b.y -= b.s);
    bullets = bullets.filter(b => b.y > -b.h);

    enemies.forEach(e => e.y += e.s);
    enemies = enemies.filter(e => e.y < canvas.height + e.h);

    bullets.forEach((b, bi) => {
        enemies.forEach((e, ei) => {
            if (b.x < e.x+e.w && b.x+b.w > e.x &&
                b.y < e.y+e.h && b.y+b.h > e.y) {
                bullets.splice(bi,1);
                enemies.splice(ei,1);
            }
        });
    });

    if (Math.random() < 0.02) spawnEnemy();
}

function draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = "magenta";
    ctx.fillRect(player.x,player.y,player.w,player.h);
    ctx.fillStyle = "yellow";
