<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SpaceBlox</title>

<style>
html, body {
    margin: 0;
    height: 100%;
    background: #333;
    color: white;
    font-family: Arial, sans-serif;
    overflow: hidden;
}

#navlink {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    background: #d3d3d3;
    color: #333;
    text-align: center;
    padding: 10px 0;
    font-size: 16px;
    z-index: 30;
}

#game-container {
    position: relative;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
}

#gameCanvas {
    background: black;
    border: 2px solid white;
}

/* ---------- PAUSE BUTTON ---------- */
#pause-btn {
    position: absolute;
    top: 50px;
    right: 12px;
    z-index: 20;
    padding: 10px 14px;
    font-size: 16px;
    border-radius: 8px;
    border: none;
    background: rgba(255,255,255,0.25);
    color: white;
}

/* ---------- MOBILE CONTROLS ---------- */
#mobile-controls {
    position: absolute;
    inset: 0;
    pointer-events: none;
    display: none;
}

#move-controls {
    position: absolute;
    left: 12px;
    bottom: 20px;
    display: flex;
    gap: 12px;
    pointer-events: auto;
}

#btnLeft, #btnRight, #btnShoot {
    width: 70px;
    height: 70px;
    font-size: 28px;
    border-radius: 14px;
    border: none;
    background: rgba(255,255,255,0.25);
    color: white;
}

#btnShoot {
    position: absolute;
    right: 12px;
    bottom: 20px;
    pointer-events: auto;
}

/* Touch devices only */
@media (pointer: coarse) {
    #mobile-controls {
        display: block;
    }
}

/* ---------- MENUS ---------- */
.menu {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.8);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 40;
}

.menu button {
    padding: 12px 22px;
    font-size: 18px;
    margin-top: 15px;
}

.hidden {
    display: none;
}
</style>
</head>

<body>
<h2 id="navlink">SpaceBlox</h2>

<div id="game-container">
    <canvas id="gameCanvas"></canvas>

    <button id="pause-btn">⏸</button>

    <!-- Mobile controls -->
    <div id="mobile-controls">
        <div id="move-controls">
            <button id="btnLeft">◀</button>
            <button id="btnRight">▶</button>
        </div>
        <button id="btnShoot">●</button>
    </div>

    <!-- Pause menu -->
    <div id="pause-menu" class="menu hidden">
        <h1>Paused</h1>
        <button id="resumeBtn">Resume</button>
    </div>

    <!-- Game over -->
    <div id="game-over-screen" class="menu hidden">
        <h1 style="color:red">Game Over</h1>
        <p>Final score: <span id="final-score">0</span></p>
        <button id="restartBtn">Restart</button>
    </div>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

const pauseBtn = document.getElementById("pause-btn");
const pauseMenu = document.getElementById("pause-menu");
const resumeBtn = document.getElementById("resumeBtn");
const gameOverScreen = document.getElementById("game-over-screen");
const finalScoreEl = document.getElementById("final-score");

let keys = {};
let isPaused = false;
let isGameOver = false;
let score = 0;
let BASE_SIZE = 40;

let player = { x:0, y:0, w:0, h:0, speed:0, shooting:false };
let bullets = [];
let enemies = [];

/* ---------- RESIZE & SCALE ---------- */
function resizeCanvas() {
    canvas.width = window.innerWidth * 0.9;
    canvas.height = window.innerHeight * 0.75;

    BASE_SIZE = Math.min(canvas.width, canvas.height) * 0.08;

    player.w = BASE_SIZE * 0.85;
    player.h = player.w;
    player.x = canvas.width / 2 - player.w / 2;
    player.y = canvas.height - player.h - 12;

    player.speed = BASE_SIZE * 0.08;
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

/* ---------- INPUT ---------- */
window.addEventListener("keydown", e => {
    keys[e.key] = true;
    if (e.key === "Escape") togglePause();
});
window.addEventListener("keyup", e => keys[e.key] = false);

/* Mobile buttons */
const btnLeft = document.getElementById("btnLeft");
const btnRight = document.getElementById("btnRight");
const btnShoot = document.getElementById("btnShoot");

function bind(btn, key) {
    btn.addEventListener("touchstart", e => {
        e.preventDefault(); keys[key] = true;
    });
    btn.addEventListener("touchend", e => {
        e.preventDefault(); keys[key] = false;
    });
}

bind(btnLeft, "ArrowLeft");
bind(btnRight, "ArrowRight");

btnShoot.addEventListener("touchstart", e => {
    e.preventDefault();
    if (!player.shooting) shoot();
    player.shooting = true;
});
btnShoot.addEventListener("touchend", () => player.shooting = false);

document.body.addEventListener("touchmove", e => e.preventDefault(), { passive:false });

pauseBtn.onclick = togglePause;
resumeBtn.onclick = togglePause;

/* ---------- GAME LOGIC ---------- */
function shoot() {
    bullets.push({
        x: player.x + player.w / 2 - BASE_SIZE * 0.1,
        y: player.y,
        w: BASE_SIZE * 0.2,
        h: BASE_SIZE * 0.5,
        s: BASE_SIZE * 0.6
    });
}

function spawnEnemy() {
    enemies.push({
        x: Math.random() * (canvas.width - BASE_SIZE),
        y: -BASE_SIZE,
        w: BASE_SIZE,
        h: BASE_SIZE,
        s: BASE_SIZE * 0.07
    });
}

function update() {
    if (isPaused || isGameOver) return;

    if ((keys["ArrowLeft"] || keys["a"]) && player.x > 0)
        player.x -= player.speed;
    if ((keys["ArrowRight"] || keys["d"]) && player.x + player.w < canvas.width)
        player.x += player.speed;

    if ((keys[" "] || keys["ArrowUp"]) && !player.shooting) {
        shoot();
        player.shooting = true;
    }
    if (!keys[" "] && !keys["ArrowUp"]) player.shooting = false;

    bullets.forEach(b => b.y -= b.s);
    bullets = bullets.filter(b => b.y > -b.h);

    enemies.forEach(e => e.y += e.s);
    enemies = enemies.filter(e => e.y < canvas.height + e.h);

    bullets.forEach((b, bi) => {
        enemies.forEach((e, ei) => {
            if (b.x < e.x+e.w && b.x+b.w > e.x &&
                b.y < e.y+e.h && b.y+b.h > e.y) {
                bullets.splice(bi,1);
                enemies.splice(ei,1);
                score += 10;
            }
        });
    });

    enemies.forEach(e => {
        if (player.x < e.x+e.w && player.x+player.w > e.x &&
            player.y < e.y+e.h && player.y+player.h > e.y) {
            gameOver();
        }
    });

    if (Math.random() < 0.02) spawnEnemy();
}

function draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);

    ctx.fillStyle = "magenta";
    ctx.fillRect(player.x,player.y,player.w,player.h);

    ctx.fillStyle = "yellow";
    bullets.forEach(b => ctx.fillRect(b.x,b.y,b.w,b.h));

    ctx.fillStyle = "red";
    enemies.forEach(e => ctx.fillRect(e.x,e.y,e.w,e.h));
}

function loop() {
    update();
    draw();
    requestAnimationFrame(loop);
}

/* ---------- STATE ---------- */
function togglePause() {
    if (isGameOver) return;
    isPaused = !isPaused;
    pauseMenu.classList.toggle("hidden", !isPaused);
}

function gameOver() {
    isGameOver = true;
    finalScoreEl.textContent = score;
    gameOverScreen.classList.remove("hidden");
}

document.getElementById("restartBtn").onclick = () => location.reload();

loop();
</script>
</body>
</html>
